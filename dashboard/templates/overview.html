{% extends "base.html" %}

{% block title %}Overview — SentinelNet{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h4 mb-0">
    <i class="bi bi-speedometer2 me-2 text-warning"></i>Visão Geral do Ambiente
  </h1>
  <a href="{{ url_for('health.overview') }}" class="btn btn-sm btn-outline-secondary">
    <i class="bi bi-arrow-clockwise me-1"></i>Atualizar
  </a>
</div>

<!-- ── KPI Cards ─────────────────────────────────────────────────────────── -->
<div class="row g-3 mb-4">

  <div class="col-sm-6 col-xl-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <p class="text-muted small mb-1"><i class="bi bi-router me-1"></i>Dispositivos</p>
        <h2 class="fw-bold text-dark">{{ overview.devices.total }}</h2>
        <div class="d-flex gap-3 mt-2 small">
          <span class="text-success">
            <i class="bi bi-check-circle-fill me-1"></i>{{ overview.devices.healthy }} saudáveis
          </span>
          <span class="text-danger">
            <i class="bi bi-x-circle-fill me-1"></i>{{ overview.devices.with_incident }} c/ incidente
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="col-sm-6 col-xl-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <p class="text-muted small mb-1"><i class="bi bi-exclamation-triangle me-1"></i>Incidentes Abertos</p>
        <h2 class="fw-bold text-dark">{{ overview.incidents.open }}</h2>
        <div class="d-flex gap-3 mt-2 small">
          <span class="badge bg-danger">{{ overview.incidents.critical }} CRITICAL</span>
          <span class="badge bg-warning text-dark">{{ overview.incidents.warning }} WARNING</span>
          <span class="badge bg-info text-dark">{{ overview.incidents.info }} INFO</span>
        </div>
      </div>
    </div>
  </div>

  <div class="col-sm-6 col-xl-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <p class="text-muted small mb-1"><i class="bi bi-wrench me-1"></i>Remediações</p>
        <h2 class="fw-bold text-dark">{{ overview.remediation.pending_approval }}</h2>
        <p class="text-muted small mt-2 mb-0">aguardando aprovação</p>
        <p class="text-success small mb-0">
          {{ overview.remediation.executed_today }} executadas hoje
        </p>
      </div>
    </div>
  </div>

  <div class="col-sm-6 col-xl-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <p class="text-muted small mb-1"><i class="bi bi-clock-history me-1"></i>SLO</p>
        <div class="row text-center mt-2">
          <div class="col-6">
            <p class="fw-bold fs-5 mb-0 text-primary">
              {{ overview.slo.mtta_minutes if overview.slo.mtta_minutes is not none else '—' }}
            </p>
            <p class="text-muted small mb-0">MTTA (min)</p>
          </div>
          <div class="col-6">
            <p class="fw-bold fs-5 mb-0 text-primary">
              {{ overview.slo.mttr_minutes if overview.slo.mttr_minutes is not none else '—' }}
            </p>
            <p class="text-muted small mb-0">MTTR (min)</p>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- ── Links Rápidos ───────────────────────────────────────────────────── -->
<div class="row g-3">
  <div class="col-md-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white fw-semibold">
        <i class="bi bi-exclamation-circle me-1 text-danger"></i>Incidentes Recentes
      </div>
      <div class="card-body text-center text-muted py-5">
        <i class="bi bi-inbox fs-1 d-block mb-2"></i>
        <p class="mb-2">Nenhum incidente registrado ainda.</p>
        <a href="{{ url_for('incidents.list_incidents') }}" class="btn btn-sm btn-outline-primary">
          Ver todos os incidentes
        </a>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white fw-semibold">
        <i class="bi bi-wrench me-1 text-warning"></i>Fila de Remediação
      </div>
      <div class="card-body text-center text-muted py-5">
        <i class="bi bi-check2-all fs-1 d-block mb-2"></i>
        <p class="mb-0">Nenhuma remediação pendente.</p>
      </div>
    </div>
  </div>
</div>

{% endblock %}
